{% extends "base.html" %}
{% block title %}Filtre · Situri – Habitat{% endblock %}
{% block content %}
<section class="container">
  <header class="hero">
    <h1>Situri – Habitat</h1>
    <p class="muted">Aceleași filtre și rezultate ca în pagina Site–Habitat.</p>
  </header>

  <div class="card">
    <form method="get" class="grid" style="grid-template-columns: repeat(4, minmax(200px, 1fr)); gap: 12px; align-items: end;">
      <label>
        <span>Mod</span>
        <select name="mode" id="mode">
          <option value="by_site"    {% if mode == 'by_site' %}selected{% endif %}>Habitate în site</option>
          <option value="by_habitat" {% if mode == 'by_habitat' %}selected{% endif %}>Site-uri pentru habitat</option>
          <option value="by_year"    {% if mode == 'by_year' %}selected{% endif %}>Toate în anul</option>
        </select>
      </label>

      <label id="siteLbl">
        <span>Site (după nume)</span>
        <input name="site_name" list="sites" value="{{ site_name|default_if_none:'' }}" autocomplete="off">
        <datalist id="sites">
          {% for s in sites %}<option value="{{ s }}">{% endfor %}
        </datalist>
      </label>

      <label id="habLbl">
        <span>Habitat (RO/EN/Cod)</span>
        <input name="habitat_name" list="habitats" value="{{ habitat_name|default_if_none:'' }}" autocomplete="off">
        <datalist id="habitats">
          {% for h in habitats %}<option value="{{ h }}">{% endfor %}
        </datalist>
      </label>

      <label id="yearLbl">
        <span>An</span>
        <input type="number" name="year" min="1900" max="2100" value="{{ year|default_if_none:'' }}">
      </label>

      <div>
        <button type="submit" class="btn">Caută</button>
        {% if qs %}
          <a class="btn btn-outline" href="?{{ request.GET.urlencode }}&export=csv">Export CSV</a>
          <a class="btn btn-outline" href="?{{ request.GET.urlencode }}&export=xlsx">Export XLSX</a>
        {% endif %}
      </div>
    </form>
  </div>

  <div class="card mt-4">
    {% if qs %}
      <div style="overflow:auto;">
        <table style="border-collapse:collapse; width:100%;">
          <thead>
            <tr>
              <th>Site</th>
              <th>Habitat (RO)</th>
              <th>Habitat (EN)</th>
              <th>Cod habitat</th>
              <th>An</th>
              <th>Suprafață (ha)</th>
              <th>Notițe</th>
            </tr>
          </thead>
          <tbody>
            {% for r in qs %}
            <tr>
              <td>{{ r.site.name }}</td>
              <td>{{ r.habitat.name_romanian }}</td>
              <td>{{ r.habitat.name_english }}</td>
              <td>{{ r.habitat.code }}</td>
              <td>{{ r.year }}</td>
              <td>{{ r.surface }}</td>
              <td>{{ r.notes }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">Nimic de afișat. Alege un mod și completează criteriile.</p>
    {% endif %}
  </div>
</section>

{% block extra_js %}
<script>
  const modeSel = document.getElementById('mode');
  const siteLbl = document.getElementById('siteLbl');
  const habLbl  = document.getElementById('habLbl');
  const yearLbl = document.getElementById('yearLbl');
  function refresh() {
    const m = modeSel.value;
    siteLbl.style.display = (m === 'by_site') ? 'block' : 'none';
    habLbl.style.display  = (m === 'by_habitat') ? 'block' : 'none';
    yearLbl.style.display = (m === 'by_year') ? 'block' : 'none';
  }
  modeSel.addEventListener('change', refresh);
  refresh();
</script>
{% endblock %}
{% endblock %}


